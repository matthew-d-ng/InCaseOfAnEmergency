<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>InCaseOfEmergency Map</title>

  <!-- CSS is on /static/style.css -->
  <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>
  <h1 align="center">Earthquakes</h1>
  <div class="nav">
    <form action="/" method="POST">
      {{ searchform.location.label }} {{ searchform.location }}
      {{ searchform.submit }}
    </form>
  </div>

  <div align="center" id="googleMap"></div>

  <script>

    function myMap() {
      var mapProp = {
        center: new google.maps.LatLng({{ center.latitude }}, {{ center.longitude }}),
        zoom: 5,
      };

    var map = new google.maps.Map(document.getElementById("googleMap"), mapProp);

    var earthquakes = JSON.parse({{ earthquakes| tojson }});

    // if (earthquakes.length > 1) {
    //   map.fitBounds(bounds);
    // }
    var bounds = new google.maps.LatLngBounds();
    for (var i = 0; i < earthquakes.length; i++) {
      var position = new google.maps.LatLng(earthquakes[i].latitude, earthquakes[i].longitude);
      var marker = new google.maps.Marker({
        position: { lat: earthquakes[i].latitude, lng: earthquakes[i].longitude },
        map: map,
        title: earthquakes[i].title,
      });
      bounds.extend(position);
    }
    map.fitBounds(position);
  
    };
  </script>

  <script src="https://maps.googleapis.com/maps/api/js?key={{APIKEY}}&callback=myMap"></script>

  <h1>Updates:</h1>
  <ul>
    {% for eq in earthQuakeList %}
    <li>{{eq.time_string() + " : " + eq.title}}</li>
    {% endfor %}
  </ul>

  <br>

  <form action="/subscribe" method="POST">
    {{ mailingform.email.label }} {{ mailingform.email }}
    {{ mailingform.location.label }} {{ mailingform.location }}
    {{ mailingform.magnitude.label }} {{ mailingform.magnitude }}
    <input type=submit value=subscribe>
  </form>

</body>

</html>